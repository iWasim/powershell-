# Specify the directory containing your original view definition files
$inputDirectoryPath = "C:\Path\To\Your\InputFiles"

# Specify the directory where the modified files should be saved
$outputDirectoryPath = "C:\Path\To\Your\OutputFiles"

# Create the output directory if it doesn't exist
if (-not (Test-Path -Path $outputDirectoryPath)) {
    New-Item -ItemType Directory -Path $outputDirectoryPath
}

# Get all .sql files in the specified input directory
$files = Get-ChildItem -Path $inputDirectoryPath -Filter "*.sql"

foreach ($file in $files) {
    # Read the content of the file
    $content = Get-Content -Path $file.FullName

    # Find the first occurrence of "CREATE" and replace it with "CREATE OR ALTER"
    $updatedContent = $content -join "`n"  # Join lines back into a single string for processing
    $firstCreateIndex = $updatedContent.IndexOf("CREATE")

    if ($firstCreateIndex -ne -1) {
        # Replace only the first occurrence
        $updatedContent = $updatedContent.Substring(0, $firstCreateIndex) + 
                         "CREATE OR ALTER" + 
                         $updatedContent.Substring($firstCreateIndex + "CREATE".Length)
    }

    # Define the output file path
    $outputFilePath = Join-Path -Path $outputDirectoryPath -ChildPath $file.Name

    # Write the updated content to the new file in the output directory
    Set-Content -Path $outputFilePath -Value $updatedContent
}

Write-Host "Replacement completed and files saved to $outputDirectoryPath."
